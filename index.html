<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>LinePack Pro — نسخه نهایی کامل</title>
    <link rel="stylesheet" href="styles/editor.css"/>
</head>

<body>
<div class="toolbar" id="toolbar">
    <div class="left">
        <!-- منوی ابزار با آیکون -->
        <div class="shape-menu" id="shapeMenu" aria-expanded="false">
            <button class="btn" id="shapeMenuBtn" title="ابزارها"><span
                    style="display:inline-flex;gap:6px;align-items:center"><svg class="icon" viewBox="0 0 24 24">
							<path d="M3 6h18M3 12h12M3 18h6"/></svg> ابزارها</span></button>
            <div class="shape-pop" id="shapePop">
                <button class="iconbtn" data-tool="select" title="انتخاب">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M4 4l8 8-3 1 1 3-2 2-3-1-1-3z"/>
                    </svg>
                </button>
                <button class="iconbtn" data-tool="move" title="جابجایی">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 2v20M2 12h20M8 8l4-4 4 4M8 16l4 4 4-4"/>
                    </svg>
                </button>
                <button class="iconbtn" data-tool="line" title="خط">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M4 18L20 6"/>
                    </svg>
                </button>
                <button class="iconbtn" data-tool="quadratic" title="منحنی">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M4 18Q12 6 20 6"/>
                    </svg>
                </button>
                <button class="iconbtn" data-tool="rect" title="مستطیل">
                    <svg class="icon" viewBox="0 0 24 24">
                        <rect x="4" y="6" width="16" height="12"/>
                    </svg>
                </button>
                <button class="iconbtn" data-tool="ellipse" title="بیضی">
                    <svg class="icon" viewBox="0 0 24 24">
                        <ellipse cx="12" cy="12" rx="8" ry="5"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="seg">
            <button id="groupBtn" class="btn" title="گروه کردن (Ctrl+G)">گروه</button>
            <button id="ungroupBtn" class="btn" title="لغو گروه (Ctrl+Shift+G)">لغو گروه</button>
        </div>
        <div class="seg">
            <label>چرخش° <input id="rotDeg" type="number" min="-360" max="360" step="1" style="width:80px" class="btn"/>
            </label>
        </div>
    </div>
    <div class="center">
        <label>ضخامت <input id="strokeWidth" class="btn" type="number" min="1" max="24" value="3" style="width:70px"/>
        </label>
        <span class="color" id="fillWrap">
				<label>پرشدن</label>
				<select id="fillMode" class="btn">
					<option value="hollow">توخالی</option>
					<option value="solid" selected>توپر</option>
					<option value="fill">بدون خط</option>
				</select>
				<input id="fillColor" type="color" value="#66ccff"/>
			</span>
        <span class="color"><label>رنگ خط</label><input id="strokeColor" type="color" value="#ffffff"/></span>
        <button id="undo" class="btn" title="واگرد (Ctrl+Z)">واگرد</button>
        <button id="redo" class="btn" title="از نو (Ctrl+Shift+Z)">از نو</button>
        <button id="apply" class="btn" title="ثبت رسم جاری (Enter)">اعمال</button>
    </div>
    <div class="right">
        <input id="fileInput" type="file" accept="application/json,.json,.linepack.json" class="btn"
               title="بارگذاری JSON"/>
        <button id="saveJSON" class="btn primary" title="ذخیره LinePack+Anim">ذخیره JSON</button>
        <button id="saveJSONMin" class="btn" title="ذخیره کمینه">ذخیره کمینه</button>
        <button id="exportPNG" class="btn" title="PNG">PNG</button>
        <button id="clear" class="btn danger" title="پاک کردن همه">پاک کردن</button>
        <!-- افزودن دکمه راهنما -->
        <button id="helpBtn" class="help-btn" title="نمایش/مخفی راهنما (H)">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zm0-18a8 8 0 1 1 0 16 8 8 0 0 1 0-16zm1 13v-2h-2v2h2zm0-10v6h-2V7h2z"/>
            </svg>
        </button>
    </div>
</div>
<!-- ===== Content: Sidebar + Stage ===== -->
<div class="content">
    <aside class="sidebar">
        <div class="tabs">
            <div id="tabElems" class="tab" aria-selected="true">المان‌ها</div>
            <div id="tabAnims" class="tab" aria-selected="false">انیمیشن‌ها</div>
        </div>
        <div id="panelElems" class="panel">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
                <div style="display:flex;gap:6px">
                    <button id="toggleAll" class="btn" title="نمایش/مخفی همه">نمایش</button>
                    <button id="deleteSel" class="btn danger" title="حذف انتخاب‌شده‌ها (Delete)">حذف</button>
                </div>
                <small class="muted">برای چند انتخاب <span class="kbd">Shift</span> را نگه دار</small>
            </div>
            <div id="elemList" class="list" style="margin-top:8px"></div>
        </div>
        <div id="panelAnims" class="panel hide">
            <div style="display:grid;gap:8px">
                <div style="display:flex;gap:6px;align-items:center">
                    <input id="animName" class="btn" type="text" placeholder="نام کلیپ" style="width: 160px"/>
                    <button id="addAnim" class="btn">+ جدید</button>
                    <button id="renameAnim" class="btn">تغییر نام</button>
                </div>
                <div style="display:flex;gap:6px;align-items:center">
                    <select id="animSelect" class="btn" style="min-width: 180px"></select>
                    <label>مدت (ثانیه) <input id="animDur" class="btn" type="number" min="1" max="360" value="5"
                                              style="width:80px"/>
                    </label>
                </div>
                <div style="display:flex;gap:6px;align-items:center">
                    <button id="setKey" class="btn">ثبت کلیدفریم</button>
                    <button id="play" class="btn">پخش</button>
                    <button id="pause" class="btn">توقف</button>
                    <button id="delAnim" class="btn danger">حذف کلیپ</button>
                </div>
            </div>
        </div>
    </aside>
    <main class="stage-wrap" id="stageWrap">
        <canvas id="canvas"></canvas>
        <div class="help hide" id="help">
            <strong>راهنما</strong>
            <ul>
                <li>از منوی <b>ابزارها</b>، <span class="badge">انتخاب</span>، <span class="badge">جابجایی</span>، <span
                        class="badge">خط</span>، <span class="badge">منحنی</span>، <span class="badge">مستطیل</span> یا
                    <span class="badge">بیضی</span> را بزن.
                </li>
                <li>چند انتخاب: <span class="kbd">Shift</span> را نگه دار و کلیک کن (یا از لیست المان‌ها).</li>
                <li>چرخش: دستگیرهٔ زرد بالای کادر انتخاب یا مقدار درجه.</li>
                <li>اگر مسیر بسته بسازی، با «گروه» یک <span class="badge">شکل پرشدنی</span> می‌سازه؛ توپرش از منوی بالا.
                </li>
                <li>تایم‌لاین پایین: روی ثانیه کلیک کن → خط می‌افتد؛ «+ فریم» یا «ثبت کلیدفریم» بزن تا سبز شود؛
                    پخش/توقف.
                </li>
            </ul>
            <div>فرمت ذخیره: <span class="badge">LinePack+Anim v2</span></div>
        </div>
        <!-- Selection visuals -->
        <div class="ghost hide" id="ghost"></div>
        <div class="rot-h hide" id="rotHandle" title="چرخش"></div>
    </main>
</div>
<!-- ===== Timeline pinned at bottom ===== -->
<div class="timeline" id="timeline">
    <div class="tl-header">
        <span class="badge">Timeline</span>
        <div class="spacer"></div>
        <button id="tlAddKey" class="btn">+ فریم</button>
        <button id="tlPlay" class="btn">پخش/توقف</button>
        <small class="muted">روی نوار کلیک کن تا ثانیه انتخاب شود</small>
    </div>
    <div class="tl-body">
        <div class="ticks" id="ticks"></div>
        <div class="cursor" id="cursor" style="left:0"></div>
        <div class="playhead" id="playhead" style="left:-10px"></div>
    </div>
</div>
<!-- ===== Icons defs ===== -->
<svg style="position:absolute;width:0;height:0" aria-hidden="true">
    <symbol id="ico-eye" viewBox="0 0 24 24">
        <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" fill="none" stroke="currentColor" stroke-width="1.6"/>
        <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.6"/>
    </symbol>
    <symbol id="ico-eyeoff" viewBox="0 0 24 24">
        <path d="M3 3l18 18M2 12s4-7 10-7c1.8 0 3.4.6 4.8 1.4M22 12s-4 7-10 7c-1.8 0-3.4-.6-4.8-1.4" fill="none"
              stroke="currentColor" stroke-width="1.6"/>
    </symbol>
    <symbol id="ico-trash" viewBox="0 0 24 24">
        <path d="M3 6h18M8 6V4h8v2M6 6l1 14h10l1-14" fill="none" stroke="currentColor" stroke-width="1.6"
              stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
</svg>
<script src="src/editor.js"></script>
</body>

</html>
